(function(window,$,undefined){var document=window.document,pix=window.pix||{};var playSecondsTotal=0,playSecondsMeter,payThreshold=10,isArrivedThreshold=false,payThreshold2=10,isArrivedThreshold2=false,videoDuration=0,arrivedDurationPercentFlags=[],videoAdResponse;pix.MIB=pix.MIB||{};pix.MIB.util=pix.MIB.util||{};pix.MIB.util.Dom={_reClassNameCache:{},_getClassRegEx:function(className){var re=pix.MIB.util.Dom._reClassNameCache[className];if(!re){re=new RegExp("(?:^|\\s+)"+className+"(?:\\s+|$)");pix.MIB.util.Dom._reClassNameCache[className]=re}return re},hasClass:function(obj,className){if(typeof obj=="undefined"||null===obj||!RegExp){return false}var re=new RegExp("(^|\\s)"+className+"(\\s|$)");if(typeof obj=="string"){return re.test(obj)}else if(typeof obj=="object"&&obj.className){return re.test(obj.className)}return false},getElementsByClassName:function(className,tag,root,apply){tag=tag||"*";root=root||document;var nodes=[],elements=root.getElementsByTagName(tag),re=pix.MIB.util.Dom._getClassRegEx(className);for(var i=0,len=elements.length;i<len;i++){if(re.test(elements[i].className)){nodes[nodes.length]=elements[i];if(apply){apply.call(elements[i],elements[i])}}}return nodes}};pix.MIB.util.createEl={get:function(sTag,oAttr,sHtml){var el=document.createElement(sTag);for(var i in oAttr){if(oAttr.hasOwnProperty(i)){el[i]=oAttr[i]}}if(sHtml){el.innerHTML=sHtml}this.append(el);return el},append:function(dNode){var dHead=document.getElementsByTagName("head")[0]||document.body;dHead.appendChild(dNode)},js:function(sUrl,sCharset){var dNode=this.get("script",{src:sUrl,type:"text/javascript"},null);if(sCharset){dNode.setAttribute("charset",sCharset)}return dNode}};var rtrim=function(str,chars){chars=chars||"\\s";return str.replace(new RegExp("["+chars+"]+$","g"),"")};pix.MIB.videoad={logPercent:function(t,param){if(!arrivedDurationPercentFlags[t]){arrivedDurationPercentFlags[t]=true;var triggerUrl=pix.MIB.config.percentSite+"?id="+videoAdResponse.ad_hash+"&u="+pix.MIB.config.uniq+"&t="+t;if(param&&param.cs){triggerUrl+="&cs="+param.cs}var imgpercent=new Image;imgpercent.src=triggerUrl}},triggerAdUrl:function(param){if(!isArrivedThreshold){isArrivedThreshold=true;var triggerUrl=videoAdResponse.ad_url;if(param&&param.cs){triggerUrl+="&cs="+param.cs}if(param&&param.vs){triggerUrl+="&vs="+param.vs}var imgau=new Image;imgau.src=triggerUrl}},triggerAdPurl:function(param){if(!isArrivedThreshold2){isArrivedThreshold2=true;var triggerUrl=videoAdResponse.ad_purl;if(param&&param.cs){triggerUrl+="&cs="+param.cs}if(param&&param.vs){triggerUrl+="&vs="+param.vs}var imgap=new Image;imgap.src=triggerUrl}},onPlay:function(){var thePlayer=this;playSecondsMeter=setTimeout(function(){playSecondsTotal+=1;if(videoDuration>0&&playSecondsTotal>=payThreshold&&!isArrivedThreshold){pix.MIB.videoad.triggerAdUrl({vs:playSecondsTotal});pix.MIB.videoad.logPercent(10)}if(videoDuration>0&&playSecondsTotal>=10){closeButton.show();pix.MIB.videoad.logPercent(10)}if(videoDuration>0&&playSecondsTotal>=Math.floor(videoDuration)*.5){pix.MIB.videoad.logPercent(50);pix.MIB.videoad.triggerAdPurl({vs:playSecondsTotal})}if(videoDuration>0&&playSecondsTotal>=Math.floor(videoDuration)*.7){pix.MIB.videoad.logPercent(70)}if(videoDuration>0&&playSecondsTotal>=Math.floor(videoDuration*.97)){pix.MIB.videoad.logPercent(100)}playSecondsMeter=setTimeout(arguments.callee,1e3)},1e3)}},pix.MIB.ysm={adHTML:[],getSitemajiad:function(oData){var dDrs=pix.MIB.config.goldAds;for(var x=0,y=dDrs.length;x<y;x++){var adType="",sHtml="";var dDr=dDrs[x];var iValue=dDr.getAttribute("model")?dDr.getAttribute("model"):"300x250";var sSize="s"+iValue;var aSize=iValue.split("x");var sWidth=aSize[0]?aSize[0]:"300";var sHeight=aSize[1]?aSize[1]:"200";if(!oData[sSize]){continue}if(sSize=="s384x288"){jQuery("#mib-video-expander").delay(500).animate({height:"320px"},1e3,function(){jQuery(".mib-video-container").animate({opacity:"toggle"},2e3,function(){});jQuery(".mib-video-background").css({height:"320px"})})}var match=RegExp("[?&]demo_ad_no=([^&]*)").exec(window.location.search),adQueryNo=match&&decodeURIComponent(match[1].replace(/\+/g," "))||"";if(0==oData[sSize].ad_num||""!=adQueryNo){if("180x280"==oData[sSize].ad_size){var mibAdContainer=dDr.parentNode.parentNode.parentNode;if(mibAdContainer){var url=pix.MIB.config.falconSite+"/ad/jsonp?field=835&demo_ad_no="+adQueryNo;$.get(url,function(data){$(dDr).html(data.html)},"jsonp")}}if("384x288".indexOf(oData[sSize].ad_size)!==-1){jQuery("body").removeClass("freeze-video-ad");jQuery("#mib-video-expander").remove()}}if(oData[sSize].ad_size==iValue){if(!oData[sSize].ad_list[0]){continue}if(""==oData[sSize].ad_list[0].ad_type){continue}adType=oData[sSize].ad_list[0].ad_type;if(oData[sSize].ad_list[0].ad_iurl){var imgi=new Image;imgi.src=oData[sSize].ad_list[0].ad_iurl}if(adType=="img"){if(-1!="s590x90,s300x250".indexOf(sSize)){$(dDr).css({display:"inline-block"})}sHtml='<a href="'+oData[sSize].ad_list[0].ad_url+'" target="_blank"><img style="margin:0 auto;display:block;min-width:'+sWidth+"px;min-height:"+sHeight+'px;" src="'+decodeURIComponent(oData[sSize].ad_list[0].ad_img)+'"></a>'}else if(adType=="movie-banner"&&1==pix.MIB.config.playMediaAd){var adBanner=oData[sSize].ad_list[0];imgDisplayDiv=dDr.parentNode.parentNode;imgDisplayDiv.setAttribute("style","background: url("+decodeURIComponent(adBanner.ad_bg_img)+") no-repeat center top");jQuery(imgDisplayDiv).on("click",function(){window.open(decodeURIComponent(adBanner.ad_purl))});jQuery(".mib-video-container").remove()}else if(adType=="movie"&&1==pix.MIB.config.playMediaAd){videoAdResponse=oData[sSize].ad_list[0];var movieAd=videoAdResponse,player=videojs("mib-video-player"),videoBackgroundDiv=dDr.parentNode.parentNode,videoContainer=dDr.parentNode,$videoContainer=$(dDr.parentNode);closeButton=jQuery(".mib-video-close");closeButton.hide();videoBackgroundDiv.setAttribute("style","background: url("+decodeURIComponent(movieAd.ad_bg_img)+") no-repeat center top");jQuery(videoBackgroundDiv).on("click",function(){window.open(decodeURIComponent(movieAd.ad_dlink))});jQuery($videoContainer.find("video")).on("click",function(event){if(10>playSecondsTotal){pix.MIB.videoad.triggerAdUrl({cs:playSecondsTotal,vs:playSecondsTotal})}pix.MIB.videoad.triggerAdPurl({cs:playSecondsTotal,vs:playSecondsTotal});pix.MIB.videoad.logPercent(101,{cs:playSecondsTotal});window.open(decodeURIComponent(movieAd.ad_purl));event.stopPropagation()});jQuery($videoContainer.find(".vjs-control-bar")).on("click",function(event){event.stopPropagation()});jQuery(closeButton).on("click",function(event){event.stopPropagation()});if("center"!==movieAd.ad_align){$(videoContainer).removeClass("mib-centered")}if("right"===movieAd.ad_align){$(videoContainer).addClass("mib-right")}else if("left"===movieAd.ad_align){$(videoContainer).addClass("mib-left")}closeButton.addClass("mib-video-close-"+movieAd.ad_close_align);player.src([{type:"video/webm",src:decodeURIComponent(movieAd.ad_img3)},{type:"video/mp4",src:decodeURIComponent(movieAd.ad_img)}]);var player_html5=jQuery("#mib-video-player_html5_api");if(player_html5){player_html5.append('<source src="'+decodeURIComponent(movieAd.ad_img)+'" type="video/mp4" />');if(""!=movieAd.ad_img3){player_html5.append('<source src="'+decodeURIComponent(movieAd.ad_img3)+'" type="video/webm" />')}}player.volume(0);player.on("loadeddata",function(){videoDuration=this.duration()});player.on("play",pix.MIB.videoad.onPlay);player.on("ended",function(){player.currentTime(1);if(videoDuration<=0){return}if(playSecondsTotal+1>=Math.floor(videoDuration)){pix.MIB.videoad.logPercent(100)}});player.on("pause",function(){clearTimeout(playSecondsMeter)});continue}else{sHtml=pix.MIB.ysm.swfHTML(decodeURIComponent(oData[sSize].ad_list[0].ad_img),sWidth,sHeight)}dDr.innerHTML=sHtml;oData[sSize].ad_list.shift()}}},adgen:function(){var dDrs=pix.MIB.config.goldAds;if(0==dDrs.length){return}var aAdMap={"180x280":1,"590x90":4,"300x250":5};var oTmp={};var sQuery="";for(var x=0,y=dDrs.length;x<y;x++){var dDr=dDrs[x];var iValue=dDr.getAttribute("model")?dDr.getAttribute("model"):"200x350";if(undefined===aAdMap[iValue]){continue}oTmp[aAdMap[iValue]]=oTmp[aAdMap[iValue]]===undefined?1:oTmp[aAdMap[iValue]]+1}for(var key in oTmp){if(oTmp.hasOwnProperty(key)){sQuery=sQuery+key+"x"+oTmp[key]+","}}sQuery=rtrim(sQuery,",");var sUrl=pix.MIB.config.falconSite+"/mib/ada?size="+sQuery+"&hosthash="+pix.MIB.config.hosthash+"&cate="+pix.MIB.config.cate+"&acate="+pix.MIB.config.article_cate_id+"&articleurl="+encodeURI(location.href)+"&callback=pix.MIB.ysm.getSitemajiad";if(pix.MIB.config.adHash){sUrl+="&ad="+pix.MIB.config.adHash}pix.MIB.util.createEl.js(sUrl)},videoadgen:function(){var dDrs=pix.MIB.config.goldAds;if(0==dDrs.length){return}var oTmp=[];var sQuery="";oTmp[3]=1;for(var key in oTmp){if(oTmp.hasOwnProperty(key)){sQuery=sQuery+key+"x"+oTmp[key]+","}}sQuery=rtrim(sQuery,",");var sUrl=pix.MIB.config.falconSite+"/mib/vaa?size="+sQuery+"&hosthash="+pix.MIB.config.hosthash+"&cate="+pix.MIB.config.cate+"&acate="+pix.MIB.config.article_cate_id+"&callback=pix.MIB.ysm.getSitemajiad";sUrl+="&ref="+pix.MIB.config.ref;if(pix.MIB.config.adHash){sUrl+="&ad="+pix.MIB.config.adHash}pix.MIB.util.createEl.js(sUrl)},detectPageScrollPlayback:function(){var playback=function(){try{var $videoContainer=$("#mib-video-expander"),player=videojs("mib-video-player"),scrollTop=$(window).scrollTop();if($videoContainer.hasClass("freeze")){return}if(scrollTop>=$videoContainer.height()*.85){player.pause()}else{if(player.paused()&&player.currentTime()<player.duration()&&scrollTop<=Math.floor($videoContainer.height()*.85)){player.play()}}}catch(ex){}};$(window).scroll(playback);jQuery(".mib-video-close a").on("click",function(){jQuery("#mib-video-expander").animate({height:"toggle"},500,function(){var player=videojs("mib-video-player");if(player){$(window).off("scroll",playback);player.pause();clearTimeout(playSecondsMeter);player.off("play",pix.MIB.videoad.onPlay);player.dispose();player=null}jQuery("body").removeClass("freeze-video-ad")})})},swfHTML:function(sAdUrl,width,height){var sHtml='<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" width="'+width+'" height="'+height+'" id="sitemajisystem"><param name="movie" value="'+decodeURIComponent(sAdUrl)+'"><param name="allowScriptAccess" value="always"><embed src="'+decodeURIComponent(sAdUrl)+'" width="'+width+'" height="'+height+'" allowscriptaccess="always"></embed></object>';return sHtml}}})(window,jQuery);